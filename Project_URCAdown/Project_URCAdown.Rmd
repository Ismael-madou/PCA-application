---
documentclass: "compterendu"
lang: true
babel-lang: "french"
geometry:
  - left=2cm
  - right=2cm
  - top=2.5cm
  - bottom=2.5cm
title: "Un titre évocateur et relativement court pour le compte-rendu"
author: 
  - Premier AUTEUR
email: 
  - premier.auteur@univ-reims.fr
date: "`r format(Sys.time(), '%d %B %Y')`"
abstract: "Un paragraphe présentant de façon synthétique le contenu du compte-rendu. \\newline Il est possible de faire des retours à la ligne. Et d'insérer des commandes \\LaTeX à condition de doubler les anti-slashs. On peut aussi y glisser du code R avec la syntaxe de R Markdown ; ainsi, R nous apprend que $3\\times4$ valent `r 3*4`."
keywords:
  - Schtroumpf
  - Marsupilami
  - Pokemon
git: "https://github.com/pregnault/urcadown"
database: "https://data.gouv.fr"
anac: "2021-2022"
diplome: "Licence Mathématiques Appliquées, 3\\up{ème} année"
module: "MA0606"
enseig: "Philippe Regnault"
evaluation: "Compte-rendu d'analyse"
coefficient: "40 \\%"
output: 
  bookdown::pdf_book:
    citation_package: biblatex
    template: template.tex
    fig_caption: yes
    keep_tex: yes
    toc: yes
biblatex: true
bibliography: biblio-cr-urca.bib
biblio-style : alphabetic
link-citations: yes
---

# Première partie

```{r, echo = FALSE}
#Ce bloc configure quelques options d'affichage pour les blocs R
library('knitr')
opts_chunk$set(comment = '', echo = FALSE,  tidy = TRUE, fig.align='center', fig.width= 4.5, fig.height = 3.2)
knit_theme$set("moe")
```

## Avec une première sous-partie

Le corps du document est rédigé selon la syntaxe de _Markdown_. On peut mettre des expressions en _italique_ ou en __gras__, des blocs de code en ligne (non évalués) comme celui-ci `sample(1:49, 6)`, insérer des commentaires de base de page[^commentaire], des liens hypertexte comme [celui-là](http://univ-reims.fr), des expressions mathématiques exprimées selon la syntaxe de \LaTeX, du genre $\cos(\theta) ^2 + \sin(\theta)^2 = 1$, voire les centrer comme ceci :
$$(a+b)^n = \sum_{k=0}^n {n \choose k} a^k b^{n-k}, \quad a,b \in \mathbb{C}, \quad n \in \mathbb{N}.$$

[^commentaire]: Ceci est un commentaire de bas de page.

## Puis une seconde

On peut également insérer des blocs de code R dont le rendu est paramétrable. Par exemple, le bloc suivant est affiché sans être évalué
```{r, echo = TRUE, eval = FALSE}
sample(1:49, 6)
```
tandis que la sortie suivante est affichée sans que le code exécuté n'apparaisse :


```{r, echo = FALSE, eval = TRUE}
set.seed(7)
options(width = 60)
un_tableau <- table(sample(c("A", "B", "C"), 100, replace = TRUE), sample(1:4, 100, replace = TRUE))
chisq.test(un_tableau)
```

On peut également insérer du code R en ligne, qui sera remplacé par le résultat de son évaluation dans le document généré, par exemple, le résultat de $3 \times 4$ vaut `r 3*4`.

# Deuxième partie

Le template `cr-urca` utilise le package __bookdown__ [@pkgbookdown] apportant quelques fonctionnalités supplémentaires, dont la gestion des références croisées et des citations. La Figure \@ref(fig:dotplotex) donne un exemple de graphique accompagné de sa légende.

(ref:capdotplotex) Un exemple de graphique produit par R, inséré et légendé grâce à _R Markdown_. S'il y a lieu, on précise la source des données, la cohorte et on explique comment lire le graphique.  
__Source :__ Jeu de données `iris`.  
__Cohorte :__ on peut insérer du code R dans la légende : il y a `r nrow(iris)` points représentés dans ce graphique.  
__Lecture :__ Débrouillez-vous.

```{r dotplotex, fig.cap = "(ref:capdotplotex)", message=FALSE, warning = FALSE}
library("ggplot2")
ggplot(data = iris) +
  geom_point(mapping = aes(x = Sepal.Length, y = Petal.Length)) +
  facet_wrap(facets = vars(Species), ncol = 3, scales="fixed") -> plot_iris
plot_iris + 
  # Ajouter ces éléments de thème pour personnaliser le rendu graphique
  theme(panel.grid.major = element_line(colour = "#DDB688", size = 0.3), 
        panel.grid.minor = element_line(colour = "#DDB688", size = 0.3, linetype = "dotted"), 
        axis.title = element_text(size = 8, colour = "#4B0000"), 
        axis.text = element_text(colour = "#4B0000"), 
        panel.background = element_rect(fill = NA), 
        plot.background = element_rect(colour = NA),
        strip.background =element_rect(fill="#DDB688"),
        strip.text = element_text(colour = '#4B0000'))
```

On peut insérer et légender des figures qui ne sont pas produites par R, comme illustré par la figure \@ref(fig:logourca).

(ref:caplogourca) Logo de l'Université de Reims Champagne-Ardenne.

```{r logourca, fig.cap = "(ref:caplogourca)", out.width="20%", fig.align='center'}
knitr::include_graphics(path = "logo_URCA.pdf")
```



On peut faire de même pour les tableaux, comme illustré par la Table \@ref(tab:tableex) pour laquelle on a utilisé le package __kableExtra__ [@pkgkableExtra] pour modifier le style du tableau.
 
(ref:captableex) Un exemple de tableau accompagné de sa légende.

```{r tableex, message = FALSE}
library('knitr')
library('kableExtra')
# set.seed(3)
# un_tableau <- table(sample(c("A", "B", "C"), 100, replace = TRUE), sample(1:4, 100, replace = TRUE))
# kable(x = un_tableau, format = 'latex', caption = "(ref:captableex)", booktabs = TRUE) %>%
#   kable_styling(latex_options = c('striped')) %>%
#   row_spec(0, bold = TRUE)
kable(x = head(iris,  n = 5L), format = "latex",
      caption =  "(ref:captableex)", 
      booktabs = TRUE) %>%
  kable_styling(latex_options = c('striped')) %>%
  row_spec(0, bold = TRUE)
```

D'autres packages sont dédiés à la mise en forme de tables pour leur incorporation dans un document _R Markdown_ ; citons notamment __gtsummary__ [@pkggtsummary], __gt__ [@pkggt] et __flextable__ [@pkgflextable]. La table \@ref(tab:exemplegtsum) présente un exemple de table mise en forme grâce à __gtsummary__ puis incorporé au document final grâce à __kableExtra__. Consulter la documentation de ces packages pour de nombreux autres exemples.

```{r exemplegtsum, message=FALSE, echo = FALSE}
library("dplyr")
library("gtsummary")
iris %>%
  select(Sepal.Length, Sepal.Width, Species) %>%
  tbl_summary(by = Species) %>%
  add_p() %>%
  add_n() %>%
  as_kable_extra(booktabs = TRUE, format = "latex",
        caption = "(ref:capexemplegtsum)") %>%
  kable_styling(latex_options = c('striped')) %>%
  row_spec(0, bold = TRUE)
```

(ref:capexemplegtsum) Un exemple de table mise en forme grâce aux packages __gtsummary__ et __kableExtra__.  
__Source :__ _data.frame_ `iris`.  
__Lecture :__ La longueur médiane des sépales des 50 iris de l'espèce _setosa_ est égale à 5.00. Entre parenthèses, sont indiqués les premier et troisième quartile (4.80, 5.20). La _p-value_ du test d'égalité des longueurs médianes entre les trois espèces d'iris est inférieure à 0.001.

Les équations mathématiques centrées et numérotées peuvent également être référencées, comme l'équation \@ref(eq:equationex).

\begin{equation}
 \mathbb{H}(p_1, \dots, p_n) := -\sum_{i=1}^n p_i \log p_i, \quad p_i \geq 0, i = 1, \dots, n \textrm{ and }  \sum_{i=1}^n p_i =1.
 (\#eq:equationex)
\end{equation}

De même, on peut faire référence aux théorèmes, propositions ou définitions que l'on déclare préalablement. Par exemple, le Théorème \@ref(thm:theoex). Consulter @xie_bookdown_2016 (partie 2.2.2) pour plus de détails.

:::{.theorem #theoex name="Théorème de Pythagore"}
Pour tout triangle rectangle, si on note $c$ la longueur de l'hypothénuse et $a$ et $b$ les longueurs des deux autres côtés, alors
$$c^2 = a^2 + b^2.$$
:::

:::{.proof}
Ceci est une preuve terminant par le symbole de fin de preuve.
:::



Pour citer un article, un ouvrage, une page web, etc, on remplit préalablement le fichier `biblio-cr-urca.bib` en déclarant les références dans la syntaxe de _Bibtex_ puis on insère la citation. Pour plus d'information sur le fonctionnement de _R Markodown_, on pourra consulter @rmarkdown_refbook2018. On peut également référencer des pages web en webographie ; 
par exemple, on pourra consulter @canales_luna_top_2022 pour un état des lieux sur la popularité des logiciels en science des données.

# Remerciements {-}

Merci la vie !

# (APPENDIX) Annexes {-}

# Annexes

On peut également ajouter une ou des partie(s) annexe(s) au document, permettant par exemple de détailler les procédures statistiques employées.

__urcadown__ fournit également un ensemble d'utilitaires pour faciliter la création de thèmes graphiques homogènes. En guise d'illustration, on génère quelques palettes de couleurs à partir des couleurs définies par le bloc de code suivant et présentées dans la Table \@ref(tab:couleurs).

```{r setupcolours, eval = TRUE, echo = TRUE}
urcalightbrown <- "#D1AD55"
urcamediumbrown <- "#AE7433"
urcaheavybrown <- "#480000"
urcalightblue <- "#88C7FA"
urcamediumblue <- "#1A9DDD"
urcaheavyblue <- "#365A8E"
senolive <- "#76bc21"
sendarkgreen <- "#007934"
senlightgreen <- "#00ae42"
darkpink <- "#DB6761"
clay <- "#D95F02"
sand <- "#FED976"
shadedpurple <- "#CD7FC5"
```

```{r couleurs, echo = FALSE, fig.align = "center"}
library('urcadown')
tibble(`Nom couleur` = c("urcalightbrown", "urcamediumbrown", "urcaheavybrown",
                         "urcalightblue", "urcamediumblue", "urcaheavyblue",
                         "senolive", "sendarkgreen", "senlightgreen",
                         "darkpink", "clay", "sand", "shadedpurple"),
       `Code hexa` = c(urcalightbrown, urcamediumbrown, urcaheavybrown,
                       urcalightblue, urcamediumblue, urcaheavyblue,
                       senolive, sendarkgreen, senlightgreen,
                       darkpink, clay, sand, shadedpurple),
       `Code RGB` = lapply(`Code hexa`, hexa2rgb)
       ) -> tib_colours

paste0("row_spec(", 1:nrow(tib_colours), ", background = '",
      c(urcalightbrown, urcamediumbrown, urcaheavybrown,
                       urcalightblue, urcamediumblue, urcaheavyblue,
                       senolive, sendarkgreen, senlightgreen,
                       darkpink, clay, sand, shadedpurple),
      "')") -> col_spec

paste0("tib_colours %>%  kbl(format = 'latex', caption = '(ref:capexemplegtsum)') %>% row_spec(0, bold = TRUE) %>%", 
  paste(col_spec, collapse = " %>% ")) %>% 
  rlang::parse_expr() -> render_tib_colour

eval(render_tib_colour)
```

(ref:capexemplegtsum) Exemples de couleurs compatibles avec la charte graphique de l'URCA, accompagnées de leurs codes hexadécimaux et RGB.